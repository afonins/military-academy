"""
üöî –ê–ì–ï–ù–¢ –ü–ê–¢–†–£–õ–ò–†–û–í–ê–ù–ò–Ø –° –§–ò–ö–°–ò–†–û–í–ê–ù–ù–û–ô –ö–ê–†–¢–û–ô

–ó–∞–ø—É—Å–∫:
    python main.py train    - –æ–±—É—á–µ–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞
    python main.py demo     - –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–±—É—á–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞
    python main.py both     - –æ–±—É—á–µ–Ω–∏–µ + –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è

–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:
- –ö–∞—Ä—Ç–∞ 10x10 —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å—Ç–µ–Ω–∞–º–∏ –∏ –∑–æ–Ω–∞–º–∏ —Ä–∏—Å–∫–∞
- Dueling DQN –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å Prioritized Experience Replay
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —É–ª—É—á—à–µ–Ω–∏–µ —Å –∫–∞–∂–¥–æ–π —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–æ–π
"""

import sys
import os

# –î–æ–±–∞–≤–ª—è–µ–º —Ç–µ–∫—É—â—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –≤ –ø—É—Ç—å
sys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))

from train import train_agent
from demo import run_demo


def print_menu():
    """–í—ã–≤–æ–¥ –º–µ–Ω—é."""
    print("\n" + "=" * 60)
    print("üöî –ê–ì–ï–ù–¢ –ü–ê–¢–†–£–õ–ò–†–û–í–ê–ù–ò–Ø - –§–ò–ö–°–ò–†–û–í–ê–ù–ù–ê–Ø –ö–ê–†–¢–ê")
    print("=" * 60)
    print("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:")
    print("  1. train  - –û–±—É—á–∏—Ç—å –∞–≥–µ–Ω—Ç–∞ —Å –Ω—É–ª—è –∏–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ")
    print("  2. demo   - –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ –æ–±—É—á–µ–Ω–Ω–æ–≥–æ –∞–≥–µ–Ω—Ç–∞")
    print("  3. both   - –û–±—É—á–∏—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –¥–µ–º–æ")
    print("  4. help   - –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø—Ä–∞–≤–∫—É")
    print("  5. exit   - –í—ã—Ö–æ–¥")
    print("=" * 60)


def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è."""
    if len(sys.argv) > 1:
        mode = sys.argv[1].lower()
    else:
        print_menu()
        mode = input("\n–í–≤–µ–¥–∏—Ç–µ —Ä–µ–∂–∏–º: ").strip().lower()
    
    if mode in ['train', '1']:
        print("\nüéì –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è...")
        print("–ù–∞–∂–º–∏—Ç–µ Ctrl+C –¥–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ (–ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—Å—è)\n")
        try:
            agent, env = train_agent(episodes=2000)
            print("\n‚úÖ –û–±—É—á–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ!")
        except KeyboardInterrupt:
            print("\n\n‚ö†Ô∏è –û–±—É—á–µ–Ω–∏–µ –ø—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
            print("–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω.")
    
    elif mode in ['demo', '2']:
        print("\nüé¨ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...")
        run_demo(episodes=3, delay=0.2, visualize=True)
    
    elif mode in ['both', '3']:
        print("\nüéì –ó–∞–ø—É—Å–∫ –æ–±—É—á–µ–Ω–∏—è...")
        try:
            agent, env = train_agent(episodes=2000)
            print("\nüé¨ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏...")
            run_demo(agent=agent, episodes=3, delay=0.2, visualize=True)
        except KeyboardInterrupt:
            print("\n\n‚ö†Ô∏è –ü—Ä–µ—Ä–≤–∞–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.")
    
    elif mode in ['help', '4']:
        print(__doc__)
    
    elif mode in ['exit', '5', 'quit']:
        print("üëã –î–æ —Å–≤–∏–¥–∞–Ω–∏—è!")
        return
    
    else:
        print(f"\n‚ùå –ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ä–µ–∂–∏–º: {mode}")
        print("–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: train, demo, both, help –∏–ª–∏ exit")


if __name__ == "__main__":
    main()
